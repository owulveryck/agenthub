---
title: "Observability Span Naming Convention"
linkTitle: "Span Naming"
weight: 30
description: >
  Standard naming convention for OpenTelemetry spans across all agents
---

# Observability Span Naming Convention

## Overview

To enable quick visual identification of which component is performing which operation in distributed traces, AgentHub follows a consistent span naming convention across all agents and services.

## Naming Standard

### Format

All manually-created spans MUST follow this format:

```
{component}.{operation}
```

Where:
- **component**: The agent or service name (lowercase, underscores for multi-word)
- **operation**: The operation being performed (lowercase, underscores for multi-word)

### Examples

| Component | Operation | Span Name |
|-----------|-----------|-----------|
| Broker | publish_event | `broker.publish_event` |
| Broker | route_event | `broker.route_event` |
| Broker | subscribe_messages | `broker.subscribe_messages` |
| Cortex | handle_message | `cortex.handle_message` |
| Cortex | llm_decide | `cortex.llm_decide` |
| Cortex | execute_actions | `cortex.execute_actions` |
| Cortex | send_chat_response | `cortex.send_chat_response` |
| Echo Agent | handle_request | `echo_agent.handle_request` |
| Echo Agent | publish_response | `echo_agent.publish_response` |
| Chat CLI | publish_message | `chat_cli.publish_message` |
| Chat CLI | display_response | `chat_cli.display_response` |

## Component Names

Standard component names for AgentHub:

| Component | Span Prefix | Description |
|-----------|-------------|-------------|
| Event Bus Broker | `broker.` | Core message routing service |
| Cortex Orchestrator | `cortex.` | AI orchestration engine |
| Echo Agent | `echo_agent.` | Echo/repeat agent |
| Chat CLI | `chat_cli.` | Command-line chat interface |
| Publisher Agent | `publisher.` | Demo publisher |
| Subscriber Agent | `subscriber.` | Demo subscriber |
| Chat Responder | `chat_responder.` | Chat response agent |

For new agents, use the agent's ID or a short descriptive name.

## Implementation

### Creating Spans

When creating spans, use the component name as prefix:

```go
// Good: Clear component identification
ctx, span := traceManager.StartSpan(ctx, "cortex.handle_message")
defer span.End()

// Bad: Missing component prefix
ctx, span := traceManager.StartSpan(ctx, "handle_message")  // ❌
defer span.End()
```

### Component Attribute

In addition to the span name prefix, ALWAYS add the component attribute for filtering and querying:

```go
ctx, span := traceManager.StartSpan(ctx, "cortex.handle_message")
defer span.End()

// Add component attribute
traceManager.AddComponentAttribute(span, "cortex")
```

This enables:
1. **Visual identification**: Span name shows component in trace waterfall
2. **Query filtering**: Component attribute enables filtering traces by component

### A2A Message Spans

For spans specifically tracking A2A message handling, use the specialized method:

```go
ctx, span := traceManager.StartA2AMessageSpan(
    ctx,
    "cortex.handle_message",  // Note: includes component prefix
    message.GetMessageId(),
    message.GetRole().String(),
)
defer span.End()

// Add component attribute
traceManager.AddComponentAttribute(span, "cortex")
```

## Operation Naming Guidelines

### Use Action Verbs

Operations should describe what the component is doing:

- `handle_message` - Processing an incoming message
- `publish_event` - Publishing an event
- `route_event` - Routing an event to subscribers
- `execute_actions` - Executing a list of actions
- `send_response` - Sending a response

### Be Specific

When possible, be specific about what kind of operation:

- ✅ `cortex.llm_decide` (specific: LLM decision making)
- ❌ `cortex.decide` (too generic)

- ✅ `echo_agent.handle_echo_request` (specific: echo request handling)
- ❌ `echo_agent.handle` (too generic)

### Use Underscores

Separate words with underscores, not hyphens or camelCase:

- ✅ `broker.publish_event`
- ❌ `broker.publish-event` (hyphens)
- ❌ `broker.publishEvent` (camelCase)

## Auto-Generated Spans

Some spans are auto-generated by instrumentation libraries (e.g., gRPC):

```
agenthub.AgentHub/PublishMessage
agenthub.AgentHub/SubscribeToMessages
```

These are **acceptable** as-is because:
1. They follow gRPC's standard naming (`package.Service/Method`)
2. Changing them would break standard gRPC tracing
3. They clearly indicate they're RPC calls

For clarity, you can create a parent span with your component prefix that wraps the gRPC call:

```go
// Parent span with component prefix
ctx, span := traceManager.StartSpan(ctx, "cortex.publish_message")
defer span.End()

// Child span will be auto-created by gRPC instrumentation
_, err := client.Client.PublishMessage(ctx, request)  // Creates: agenthub.AgentHub/PublishMessage
```

## Benefits

### Visual Clarity

In trace visualizations, you can immediately identify components:

```
broker.publish_event
├─ broker.route_event
│  ├─ cortex.handle_message
│  │  ├─ cortex.llm_decide
│  │  └─ cortex.execute_actions
│  │     └─ cortex.send_chat_response
│  └─ echo_agent.handle_request
│     └─ echo_agent.publish_response
└─ broker.route_event
   └─ chat_cli.display_response
```

### Query & Filter

Filter traces by component using attributes:

```
# All cortex operations
component = "cortex"

# All message handling across components
span.name LIKE "%.handle_message"

# Echo agent operations only
component = "echo_agent"
```

### Debugging

When debugging issues:
1. Look at span name to identify which component failed
2. No need to expand span details to find component
3. Quickly trace request flow across components

## Migration

Existing code should be updated to follow this convention:

### Before

```go
// Inconsistent naming
ctx, span := traceManager.StartSpan(ctx, "handle_message")  // Who is handling?
ctx, span := traceManager.StartSpan(ctx, "cortex_chat_request")  // Inconsistent separator
ctx, span := traceManager.StartSpan(ctx, "cli_publish_user_message")  // Inconsistent prefix
```

### After

```go
// Consistent naming
ctx, span := traceManager.StartSpan(ctx, "cortex.handle_message")
ctx, span := traceManager.StartSpan(ctx, "cortex.chat_request")
ctx, span := traceManager.StartSpan(ctx, "chat_cli.publish_message")
```

## Validation

To ensure compliance, span names should be validated:

1. **Code Review**: Check span names follow `{component}.{operation}` format
2. **Testing**: Verify component attribute is set on all spans
3. **Trace Review**: Inspect actual traces to confirm naming consistency

## See Also

- [Distributed Tracing Guide](../distributed_tracing/)
- [OpenTelemetry Best Practices](https://opentelemetry.io/docs/specs/otel/trace/api/#span)
- [Semantic Conventions](https://opentelemetry.io/docs/specs/semconv/)
